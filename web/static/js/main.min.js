!function(t){t(function(){t(".button-collapse").sideNav(),t.validator.addMethod("notempty",function(t,a){return this.optional(a)||/\S/.test(t)},"Пожалуйста, укажите не пустое значение");var a={validate:{validClass:"valid",errorClass:"invalid"}},r={stateAjax:function(a){var r=t(a);r.find("[data-progress]").css("visibility","visible"),r.find(":submit").prop("disabled",!0),r.find(':input:not([readonly="readonly"])').attr("data-ajax-submit","progress").prop("readonly",!0)},stateNormal:function(a){var r=t(a);r.find(":submit").prop("disabled",!1),r.find("[data-progress]").css("visibility","hidden"),r.find(':input[data-ajax-submit="progress"]').attr("data-ajax-submit","").prop("readonly",!1)},populate:function(a,r){var e=t(a);t.each(r,function(t,a){e.find('[name="'+t+'"]').val(a)})},showErrors:function(a,r){var e=t(a).validate(),n={};t.each(r,function(a,r){t.isArray(r)&&(n[a]=r.join("<br>"))}),e.showErrors(n)},ajaxSubmit:function(a,e,n){return e=e||function(){},n=n||function(){},t(a).ajaxSubmit({beforeSubmit:n}).data("jqxhr").done(e).always(function(){r.stateNormal(a)})}},e={info:function(t){Materialize.toast(t,7e3)},alert:function(t){Materialize.toast(t,7e3,"red darken-2 text-white")}};t(document).ajaxError(function(a,r,n,o){0===r.status?(e.alert("Непредвиденная ошибка"),e.info("Попробуйте обновить страницу")):390==r.status?"string"===t.type(r.responseJSON)?window.location=r.responseJSON:e.info("Попробуйте обновить страницу"):404==r.status?(e.alert("Страница не найдена"),e.info("Попробуйте обновить страницу")):403==r.status?(e.alert("Доступ запрещён"),e.info("Попробуйте перелогиниться")):400<=r.status&&r.status<500?(e.alert("Запрос не обработан"),e.info("Попробуйте обновить страницу")):500==r.status?(e.alert("Ошибка сервера"),e.info("Попробуйте ещё раз")):503==r.status?(e.alert("Сервер на обслуживании"),e.info("Заходите позже")):504==r.status?(e.alert("Сервер не ответил"),e.info("Попробуйте ещё раз")):500<=r.status&&r.status<600?(e.alert("Ошибка сервера"),e.info("Попробуйте обновить страницу")):"parsererror"===o?(e.alert("Ошибка браузера"),e.info("Попробуйте обновить страницу")):"timeout"===o?(e.alert("Сервер не ответил"),e.info("Попробуйте ещё раз")):"abort"===o?(e.alert("Сервер оборвал связь"),e.info("Попробуйте ещё раз")):(e.alert("Произошло что-то странное"),e.info("Попробуйте ещё раз"))});var n={},o=t("#nav-user-info");o.length&&(n={avatar:o.data("avatar"),username:o.data("username")});var i=t("#nav-balance-handler"),s=t("#order-form"),d=t("#order-list-fetched"),u=t("#go-to-older-orders-form"),f=t("#login-form");!function(){if(s.length){var o=t("#created-orders"),i=Handlebars.compile(t("#created-orders-new").html());s.validate(t.extend({},a.validate,{rules:{description:{notempty:{}}},submitHandler:function(a){var s=t(a);s.ajaxSubmit({beforeSubmit:function(){r.stateAjax(a)}}).data("jqxhr").done(function(s){if(s.createdOrder&&!t.isEmptyObject(s.createdOrder)){e.info("Заказ на сумму "+s.createdOrder.price_dollar+" успешно добавлен");var d=i({customer:n,order:s.createdOrder});o.prepend(d)}s.order&&r.populate(a,s.order),s.errors&&r.showErrors(a,s.errors),s.createErrors&&!t.isEmptyObject(s.createErrors)&&t.each(s.createErrors,function(t,a){e.alert(a)})}).always(function(){r.stateNormal(a)})}}))}}(),function(){d.on("submit",'form[data-form="execute-order"]',function(){var a=this,n=t(a).find('[name="id"]').val(),o=t("#order-item-"+n),s=function(a){a.success&&("undefined"!=typeof a.balance&&a.balance!==!1?(e.info("Успешно! Ваш баланс: "+a.balance),i.text(a.balance)):e.alert("Не удалось получить баланс"),o.length&&(o.find(":submit").remove(),o.fadeOut(200,function(){t(this).remove()}))),a.error&&e.error(a.error)};return r.ajaxSubmit(a,s),!1})}(),function(){if(u.length){var a=Handlebars.compile(t("#new-fetched-order").html());u.on("submit",function(){var e=this,n=t(e),o=n.find('[name="from"]'),i=n.find('[name="fromRand"]');return n.ajaxSubmit({beforeSubmit:function(){r.stateAjax(e)}}).data("jqxhr").done(function(r){o.val(r.next),i.val(r.nextRand);var e=t.map(r.orders,function(t){return a({order:t})});e.length&&d.append(e)}).always(function(){r.stateNormal(e)}),!1})}}(),function(){if(f.length){var e=f.find("[data-login-error]");f.validate(t.extend({},a.validate,{rules:{username:{notempty:{}}},submitHandler:function(a){var n=t(a);n.ajaxSubmit({beforeSubmit:function(){e.html(""),r.stateAjax(a)}}).data("jqxhr").done(function(t){t.error&&e.text(t.error)}).always(function(){r.stateNormal(a)})}}))}}()})}(jQuery);