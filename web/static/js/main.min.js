!function(e){e(function(){e(".button-collapse").sideNav(),e.validator.addMethod("notempty",function(e,a){return this.optional(a)||/\S/.test(e)},"Пожалуйста, укажите не пустое значение");var a={validate:{validClass:"valid",errorClass:"invalid"}},r={stateAjax:function(a){var r=e(a);r.find("[data-progress]").css("visibility","visible"),r.find(":submit").prop("disabled",!0),r.find(':input:not([readonly="readonly"])').attr("data-ajax-submit","progress").prop("readonly",!0)},stateNormal:function(a){var r=e(a);r.find(":submit").prop("disabled",!1),r.find("[data-progress]").css("visibility","hidden"),r.find(':input[data-ajax-submit="progress"]').attr("data-ajax-submit","").prop("readonly",!1)},populate:function(a,r){var t=e(a);e.each(r,function(e,a){t.find('[name="'+e+'"]').val(a)})},showErrors:function(a,r){var t=e(a).validate(),o={};e.each(r,function(a,r){e.isArray(r)&&(o[a]=r.join("<br>"))}),t.showErrors(o)}};e(document).ajaxError(function(e,a,r,t){0===a.status?console.log("status === 0",e,a,r,t):404==a.status?console.log(404,e,a,r,t):503==a.status?console.log(503,e,a,r,t):"parsererror"===t?console.log("parsererror",e,a,r,t):"timeout"===t?console.log("timeout",e,a,r,t):"abort"===t?console.log("abort",e,a,r,t):console.log("uncaught exception",e,a,r,t)});var t={},o=e("#nav-user-info");o.length&&(t={avatar:o.data("avatar"),username:o.data("username")});var n=e("#nav-balance-handler"),i=e("#order-form");if(i.length){var s=e("#created-orders"),d=Handlebars.compile(e("#created-orders-new").html());i.validate(e.extend({},a.validate,{rules:{description:{notempty:{}}},submitHandler:function(a){var o=e(a);o.ajaxSubmit({beforeSubmit:function(){r.stateAjax(a)}}).data("jqxhr").done(function(o,n,i){if(o.createdOrder&&!e.isEmptyObject(o.createdOrder)){Materialize.toast("Заказ на сумму "+o.createdOrder.price_dollar+" успешно добавлен",6e3);var l=d({customer:t,order:o.createdOrder});s.prepend(l)}o.order&&r.populate(a,o.order),o.errors&&r.showErrors(a,o.errors),o.createErrors&&!e.isEmptyObject(o.createErrors)&&e.each(o.createErrors,function(e,a){Materialize.toast("Ошибка: "+a,1e4)})}).always(function(e,t){r.stateNormal(a)})}}))}var l=function(){var a=this,t=e(a),o=e(a).find('[name="id"]').val(),i=e("#order-item-"+o);return t.ajaxSubmit({beforeSubmit:function(){r.stateAjax(a)}}).data("jqxhr").done(function(a,r,t){a.success&&("undefined"!=typeof a.balance&&a.balance!==!1?(Materialize.toast("Успешно! Ваш баланс: "+a.balance,6e3),n.html(a.balance)):Materialize.toast("Не удалось получить баланс",6e3),i.length&&(i.find(":submit").remove(),i.fadeOut(200,function(){e(this).remove()}))),a.error&&Materialize.toast(a.error,6e3)}).always(function(e,t){r.stateNormal(a)}),!1};e('form[data-form="execute-order"]').on("submit",l);var c=e("#go-to-older-orders-form");if(c.length){var u=e("#order-list-fetched"),f=Handlebars.compile(e("#new-fetched-order").html());c.on("submit",function(){var a=this,t=e(a),o=t.find('[name="from"]'),n=t.find('[name="fromRand"]');return t.ajaxSubmit({beforeSubmit:function(){r.stateAjax(a)}}).data("jqxhr").done(function(a,r,t){console.log(a),o.val(a.next),n.val(a.nextRand);var i=[];e.each(a.orders,function(a,r){var t=f({order:r}),o=e(t).attr("data-fetched","new");i.push(o)}),i.length&&u.append(i),u.find('[data-fetched="new"] form[data-form="execute-order"]').on("submit",l)}).always(function(e,t){r.stateNormal(a)}),!1})}})}(jQuery);