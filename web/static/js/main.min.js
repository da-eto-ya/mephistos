!function(e){e(function(){var r=e("#order-form"),t=e("#order-list-fetched"),n=e("#go-to-older-orders-form"),a=e("#login-form"),o=$$.megaphone,i=$$.elems.currentUserInfo,d=$$.elems.balanceHandler,f=$$.forms.helper,c=$$.forms.defaults.validate;!function(){if(r.length){var t=e("#created-orders"),n=Handlebars.compile(e("#created-orders-new").html());r.validate(e.extend({},c,{rules:{description:{notempty:{}}},submitHandler:function(r){var a=e(r);a.ajaxSubmit({beforeSubmit:function(){f.stateAjax(r)}}).data("jqxhr").done(function(a){if(a.createdOrder&&!e.isEmptyObject(a.createdOrder)){o.info("Заказ на сумму "+a.createdOrder.price_dollar+" успешно добавлен");var d=n({customer:i,order:a.createdOrder});t.prepend(d)}a.order&&f.populate(r,a.order),a.errors&&f.showErrors(r,a.errors),a.createErrors&&!e.isEmptyObject(a.createErrors)&&e.each(a.createErrors,function(e,r){o.alert(r)})}).always(function(){f.stateNormal(r)})}}))}}(),function(){t.on("submit",'form[data-form="execute-order"]',function(){var r=this,t=e(r).find('[name="id"]').val(),n=e("#order-item-"+t),a=function(r){r.success&&("undefined"!=typeof r.balance&&r.balance!==!1?(o.info("Успешно! Ваш баланс: "+r.balance),d.text(r.balance)):o.alert("Не удалось получить баланс"),n.length&&(n.find(":submit").remove(),n.fadeOut(200,function(){e(this).remove()}))),r.error&&o.error(r.error)};return f.ajaxSubmit(r,a),!1})}(),function(){if(n.length){var r=Handlebars.compile(e("#new-fetched-order").html());n.on("submit",function(){var n=this,a=e(n),o=a.find('[name="from"]'),i=a.find('[name="fromRand"]');return a.ajaxSubmit({beforeSubmit:function(){f.stateAjax(n)}}).data("jqxhr").done(function(n){o.val(n.next),i.val(n.nextRand);var a=e.map(n.orders,function(e){return r({order:e})});a.length&&t.append(a)}).always(function(){f.stateNormal(n)}),!1})}}(),function(){if(a.length){var r=a.find("[data-login-error]");a.validate(e.extend({},c,{rules:{username:{notempty:{}}},submitHandler:function(t){var n=e(t);n.ajaxSubmit({beforeSubmit:function(){r.html(""),f.stateAjax(t)}}).data("jqxhr").done(function(e){e.error&&r.text(e.error)}).always(function(){f.stateNormal(t)})}}))}}()})}(jQuery);