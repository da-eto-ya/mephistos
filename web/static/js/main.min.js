!function(e){e(function(){e(".button-collapse").sideNav(),e.validator.addMethod("notempty",function(e,t){return this.optional(t)||/\S/.test(e)},"Пожалуйста, укажите не пустое значение");var t={validate:{validClass:"valid",errorClass:"invalid"}},a={stateAjax:function(t){var a=e(t);a.find("[data-progress]").css("visibility","visible"),a.find(":submit").prop("disabled",!0),a.find(':input:not([readonly="readonly"])').attr("data-ajax-submit","progress").prop("readonly",!0)},stateNormal:function(t){var a=e(t);a.find(":submit").prop("disabled",!1),a.find("[data-progress]").css("visibility","hidden"),a.find(':input[data-ajax-submit="progress"]').attr("data-ajax-submit","").prop("readonly",!1)},populate:function(t,a){var r=e(t);e.each(a,function(e,t){r.find('[name="'+e+'"]').val(t)})},showErrors:function(t,a){var r=e(t).validate(),o={};e.each(a,function(t,a){e.isArray(a)&&(o[t]=a.join("<br>"))}),r.showErrors(o)}};e(document).ajaxError(function(t,a,r,o){0===a.status?console.log("status === 0",t,a,r,o):390==a.status?"string"===e.type(a.responseJSON)?window.location=a.responseJSON:Materialize.toast("Попробуйте обновить страницу (F5)",5e3):404==a.status?console.log(404,t,a,r,o):503==a.status?console.log(503,t,a,r,o):"parsererror"===o?console.log("parsererror",t,a,r,o):"timeout"===o?console.log("timeout",t,a,r,o):"abort"===o?console.log("abort",t,a,r,o):console.log("uncaught exception",t,a,r,o)});var r={},o=e("#nav-user-info");o.length&&(r={avatar:o.data("avatar"),username:o.data("username")});var n=e("#nav-balance-handler"),i=e("#order-form"),s=e("#order-list-fetched"),d=e("#go-to-older-orders-form"),l=e("#login-form");!function(){if(i.length){var o=e("#created-orders"),n=Handlebars.compile(e("#created-orders-new").html());i.validate(e.extend({},t.validate,{rules:{description:{notempty:{}}},submitHandler:function(t){var i=e(t);i.ajaxSubmit({beforeSubmit:function(){a.stateAjax(t)}}).data("jqxhr").done(function(i,s,d){if(i.createdOrder&&!e.isEmptyObject(i.createdOrder)){Materialize.toast("Заказ на сумму "+i.createdOrder.price_dollar+" успешно добавлен",6e3);var l=n({customer:r,order:i.createdOrder});o.prepend(l)}i.order&&a.populate(t,i.order),i.errors&&a.showErrors(t,i.errors),i.createErrors&&!e.isEmptyObject(i.createErrors)&&e.each(i.createErrors,function(e,t){Materialize.toast("Ошибка: "+t,1e4)})}).always(function(e,r){a.stateNormal(t)})}}))}}(),function(){s.on("submit",'form[data-form="execute-order"]',function(){var t=this,r=e(t),o=e(t).find('[name="id"]').val(),i=e("#order-item-"+o);return r.ajaxSubmit({beforeSubmit:function(){a.stateAjax(t)}}).data("jqxhr").done(function(t,a,r){console.log(t),t.success&&("undefined"!=typeof t.balance&&t.balance!==!1?(Materialize.toast("Успешно! Ваш баланс: "+t.balance,6e3),n.text(t.balance)):Materialize.toast("Не удалось получить баланс",6e3),i.length&&(i.find(":submit").remove(),i.fadeOut(200,function(){e(this).remove()}))),t.error&&Materialize.toast(t.error,6e3)}).always(function(e,r){a.stateNormal(t)}),!1})}(),function(){if(d.length){var t=Handlebars.compile(e("#new-fetched-order").html());d.on("submit",function(){var r=this,o=e(r),n=o.find('[name="from"]'),i=o.find('[name="fromRand"]');return o.ajaxSubmit({beforeSubmit:function(){a.stateAjax(r)}}).data("jqxhr").done(function(a,r,o){console.log(a),n.val(a.next),i.val(a.nextRand);var d=e.map(a.orders,function(e){return t({order:e})});d.length&&s.append(d)}).always(function(e,t){a.stateNormal(r)}),!1})}}(),function(){if(l.length){var r=l.find("[data-login-error]");l.validate(e.extend({},t.validate,{rules:{username:{notempty:{}}},submitHandler:function(t){var o=e(t);o.ajaxSubmit({beforeSubmit:function(){r.html(""),a.stateAjax(t)}}).data("jqxhr").done(function(e,t,a){e.error&&r.text(e.error)}).always(function(e,r){a.stateNormal(t)})}}))}}()})}(jQuery);